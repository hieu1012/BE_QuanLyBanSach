# Hướng Dẫn Khởi Tạo Database

## Giới Thiệu
Script này sẽ khởi tạo database `quanlybansach` với tất cả các bảng và dữ liệu mẫu cho ứng dụng Quản Lý Bán Sách.

## Yêu Cầu
- MySQL hoặc MariaDB đã được cài đặt
- Có quyền truy cập vào máy chủ database
- MySQL/MariaDB client được cài đặt và có trong PATH

## Cấu Hình Mặc Định
```
Host: localhost
Port: 3306
User: root
Password: root
Database: quanlybansach
```

Nếu cấu hình của bạn khác, vui lòng chỉnh sửa các biến trong file script trước khi chạy.

## Cách Sử Dụng

### Trên Windows
1. Mở Command Prompt (cmd) hoặc PowerShell
2. Chuyển tới thư mục `database`:
   ```
   cd path\to\BE_QuanLyBanSach\database
   ```
3. Chạy script:
   ```
   run-init.bat
   ```

### Trên Linux/macOS
1. Mở Terminal
2. Chuyển tới thư mục `database`:
   ```
   cd path/to/BE_QuanLyBanSach/database
   ```
3. Cho phép thực thi script:
   ```
   chmod +x run-init.sh
   ```
4. Chạy script:
   ```
   ./run-init.sh
   ```

## Tệp Tin
- **init-database.sql**: File SQL chứa toàn bộ lệnh tạo database, bảng, và dữ liệu mẫu
- **run-init.bat**: Script batch cho Windows
- **run-init.sh**: Shell script cho Linux/macOS
- **README.md**: Tệp này

## Dữ Liệu Mẫu Được Tạo

### Users (Người Dùng)
- 2 Admin users
- 10 Customer users

**Mật khẩu mặc định cho tất cả tài khoản: `1111`**

### Categories (Danh Mục)
- 8 danh mục sách (Văn Học, Kỹ Thuật, Kinh Tế, Tâm Lý, Lịch Sử, Khoa Học, Ngoại Ngữ, Trẻ Em)

### Products (Sản Phẩm)
- 29 sách mẫu phân bố trong các danh mục

## Tài Khoản Test

### Admin Accounts
| Username | Email | Password | Role |
|----------|-------|----------|------|
| admin01 | admin01@bookstore.com | 1111 | ADMIN |
| admin02 | admin02@bookstore.com | 1111 | ADMIN |

### Customer Accounts
| Username | Email | Password | Role |
|----------|-------|----------|------|
| customer01 | customer01@gmail.com | 1111 | USER |
| customer02 | customer02@gmail.com | 1111 | USER |
| customer03 | customer03@gmail.com | 1111 | USER |
| customer04 | customer04@gmail.com | 1111 | USER |
| customer05 | customer05@gmail.com | 1111 | USER |
| customer06 | customer06@gmail.com | 1111 | USER |
| customer07 | customer07@gmail.com | 1111 | USER |
| customer08 | customer08@gmail.com | 1111 | USER |
| customer09 | customer09@gmail.com | 1111 | USER |
| customer10 | customer10@gmail.com | 1111 | USER |

## Hướng Dẫn Test API

### Sử dụng Postman hoặc cURL

#### 1. Login (Lấy JWT Token)
```bash
POST http://localhost:8081/api/auth/login
Content-Type: application/json

{
  "username": "admin01",
  "password": "1111"
}
```

**Hoặc với customer:**
```bash
{
  "username": "customer01",
  "password": "1111"
}
```

**Response:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "message": "Login successful"
}
```

#### 2. Sử dụng Token để gọi API
Thêm header vào tất cả các request tiếp theo:
```
Authorization: Bearer <token_từ_login>
```

#### 3. Ví dụ gọi API
```bash
# Lấy danh sách danh mục
GET http://localhost:8081/api/categories

# Lấy danh sách sản phẩm
GET http://localhost:8081/api/products

# Tìm kiếm sản phẩm
GET http://localhost:8081/api/products/search?keyword=Java

# Lấy sản phẩm theo danh mục
GET http://localhost:8081/api/products/category/1
```

## Xác Minh Dữ Liệu
Sau khi chạy script, bạn có thể xác minh dữ liệu bằng:

```sql
-- Kết nối tới database
mysql -u root -p

-- Sử dụng database
USE quanlybansach;

-- Kiểm tra các bảng
SHOW TABLES;

-- Đếm dữ liệu
SELECT COUNT(*) as total_users FROM users;
SELECT COUNT(*) as total_categories FROM categories;
SELECT COUNT(*) as total_products FROM products;

-- Xem dữ liệu chi tiết
SELECT * FROM users;
SELECT * FROM categories;
SELECT * FROM products LIMIT 10;
```

## Ghi Chú Quan Trọng
1. Script sẽ **XÓA** tất cả dữ liệu cũ nếu các bảng đã tồn tại
2. Nếu database không tồn tại, nó sẽ được tạo tự động
3. Hãy chắc chắn rằng MySQL/MariaDB service đang chạy trước khi thực thi
4. Tất cả mật khẩu được mã hóa bằng BCrypt (Spring Security)
5. Mật khẩu mặc định là `1111` cho tất cả tài khoản test

## Khắc Phục Sự Cố

### Lỗi: "mysql command not found"
- **Nguyên nhân**: MySQL/MariaDB client chưa được cài đặt hoặc không có trong PATH
- **Giải pháp**:
  - Cài đặt MySQL/MariaDB client
  - Thêm thư mục bin của MySQL vào PATH

### Lỗi: "Access denied for user 'root'@'localhost'"
- **Nguyên nhân**: Mật khẩu database sai
- **Giải pháp**: Chỉnh sửa biến `DB_PASSWORD` trong script hoặc file init-database.sql

### Lỗi: "Can't connect to MySQL server on 'localhost'"
- **Nguyên nhân**: MySQL/MariaDB server không chạy
- **Giải pháp**: Khởi động dịch vụ MySQL/MariaDB

### Lỗi: Không thể login với tài khoản test
- **Nguyên nhân**: Password được lưu dưới dạng hash BCrypt
- **Giải pháp**: Sử dụng mật khẩu gốc `1111` khi login
- **Kiểm tra**: Xem bảng users có dữ liệu không bằng lệnh:
  ```sql
  SELECT username, email, role FROM users;
  ```

## Hỗ Trợ
Nếu gặp vấn đề, vui lòng:
1. Kiểm tra lại MySQL/MariaDB đang chạy
2. Kiểm tra username và password
3. Kiểm tra host và port
4. Xem thêm trong file init-database.sql để hiểu cấu trúc database

## Cấu Trúc Database

```
quanlybansach
├── users 
│   └── Columns: id, username, email, password, full_name, phone_number, address, role, is_active, created_at, updated_at
├── categories 
│   └── Columns: id, name, image_name, is_active
├── products 
│   └── Columns: id, title, description, price, discount_price, discount, stock, image_name, is_active, category_id
├── order_addresses 
│   └── Columns: id, first_name, last_name, email, mobile_no, address, city, state, pincode
├── orders 
│   └── Columns: id, order_id, order_date, status, payment_type, total_price, order_address_id, user_id
└── order_items 
    └── Columns: id, order_id, product_id, quantity, price
```

## Mã Hóa Mật Khẩu (BCrypt)
- Thuật toán: BCrypt
- Salt rounds: 10
- Mật khẩu gốc: `1111`
- Hash: `$2a$10$slYQmyNdGzin7olVN3p5be4DlH.PKZbv5H8KnzzVgXXbVxzy4QAZG`

Bạn có thể tạo hash mật khẩu riêng bằng Spring Security:
```java
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
String hashedPassword = encoder.encode("your_password");
System.out.println(hashedPassword);
```

---
**Ngày tạo**: 19/11/2025
